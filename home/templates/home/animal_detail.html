{% extends 'home/base.html' %}
{% load static %}

{% block title %}{{ animal.name }}{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
        <li class="breadcrumb-item"><a href="{% url 'section_view' section %}">{{ section|title }}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ animal.name }}</li>
    </ol>
</nav>

<!-- Animal Header -->
<div class="animal-header mb-4">
    <h1 class="display-4">{{ animal.name }}</h1>
    <div class="d-flex align-items-center mb-2">
        <div class="me-3">
            <span class="badge bg-primary">{{ section|title }}</span>
        </div>
        <div class="me-3">
            <span class="badge bg-secondary">{{ animal.category }}</span>
        </div>
    </div>
</div>

<div class="row mb-5">
    <!-- Animal Images -->
    <div class="col-lg-6 mb-4 mb-lg-0">
        <div id="animalCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                {% if animal.image1 %}
                <div class="carousel-item active">
                    <img src="{{ animal.image1.url }}" class="d-block w-100 rounded" alt="{{ animal.name }}">
                </div>
                {% endif %}
                
                {% if animal.image2 %}
                <div class="carousel-item {% if not animal.image1 %}active{% endif %}">
                    <img src="{{ animal.image2.url }}" class="d-block w-100 rounded" alt="{{ animal.name }}">
                </div>
                {% endif %}
                
                {% if animal.image3 %}
                <div class="carousel-item {% if not animal.image1 and not animal.image2 %}active{% endif %}">
                    <img src="{{ animal.image3.url }}" class="d-block w-100 rounded" alt="{{ animal.name }}">
                </div>
                {% endif %}
                
                {% if not animal.image1 and not animal.image2 and not animal.image3 %}
                <div class="carousel-item active">
                    <div class="placeholder-image d-flex align-items-center justify-content-center bg-light" style="height: 400px;">
                        <i class="fas fa-paw fa-5x text-secondary"></i>
                    </div>
                </div>
                {% endif %}
            </div>
            
            {% if animal.image1 and animal.image2 or animal.image2 and animal.image3 or animal.image1 and animal.image3 %}
            <button class="carousel-control-prev" type="button" data-bs-target="#animalCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#animalCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
            {% endif %}
        </div>
        
        {% if animal.audio %}
        <div class="mt-3">
            <h4>Listen to {{ animal.name }} sounds:</h4>
            <audio controls class="w-100">
                <source src="{{ animal.audio.url }}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
            <p class="text-muted small">{{ animal.audio_description|default:"" }}</p>
        </div>
        {% endif %}
    </div>
    
    <!-- Animal Information -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <h3>About {{ animal.name }}</h3>
            </div>
            <div class="card-body">
                {% if section == 'kids' %}
                <div class="animal-description">
                    {{ animal.description_kids|linebreaks|default:"No description available for kids." }}
                </div>
                {% else %}
                <div class="animal-description">
                    {{ animal.description_adults|linebreaks|default:"No detailed description available." }}
                </div>
                <div class="mt-4">
                    <h4>Habitat:</h4>
                    <p>{{ animal.habitat_info|linebreaks|default:"No habitat information available." }}</p>
                </div>
                <div class="mt-4">
                    <h4>Behavior:</h4>
                    <p>{{ animal.behavior_info|linebreaks|default:"No behavior information available." }}</p>
                </div>
                {% if animal.conservation_status %}
                <div class="mt-4">
                    <h4>Conservation Status:</h4>
                    <p>{{ animal.conservation_status }}</p>
                </div>
                {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Comments Section -->
<div class="comments-list">
    {% for comment in animal.contributions.all %}
    <div class="comment mb-3 p-3 border-bottom">
        <div class="d-flex justify-content-between mb-2">
            <div class="user">
                <strong>{{ comment.user.username }}</strong>
            </div>
            <div class="date text-muted small">
                {{ comment.created_at|date:"F j, Y H:i" }}
            </div>
        </div>
        <div class="content">
            {{ comment.fact }}  <!-- Changed from comment.content to comment.fact -->
        </div>
    </div>
    {% empty %}
    <div class="alert alert-light text-center">
        No comments yet. Be the first to comment!
    </div>
    {% endfor %}
</div>

<!-- In animal_detail.html -->
<form method="post" action="{% url 'add_comment' animal.id %}">
    {% csrf_token %}
    <div class="mb-3">
        <textarea class="form-control" name="content" rows="3" placeholder="Share your thoughts about this animal..."></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Submit Comment</button>
</form>

<!-- Related Animals -->
{% if related_animals %}
<section class="mb-5">
    <h2 class="section-title mb-4">Related Animals</h2>
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
        {% for animal in related_animals %}
        <div class="col">
            {% include 'home/includes/animal_card.html' with animal=animal section=section %}
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}
{% endblock %}